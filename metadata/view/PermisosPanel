{
    "type": "Ext.panel.Panel",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "closable": true,
        "container|align": "stretch",
        "designer|userAlias": "permisospanel",
        "designer|userClassName": "PermisosPanel",
        "glyph": "f023@FontAwesome",
        "id": "permisosPanel",
        "layout": "hbox",
        "title": "Permisos"
    },
    "configAlternates": {
        "closable": "boolean",
        "designer|userAlias": "string",
        "designer|userClassName": "string",
        "glyph": "auto",
        "id": "string",
        "title": "string",
        "viewModel": "object",
        "container|align": "string",
        "layout": "string"
    },
    "name": "PerfilesPagoPanel1",
    "designerId": "6ff83ac1-9ec0-484e-ba57-f2a7fc44a3fd",
    "viewControllerInstanceId": "12ffe505-7dbd-4afe-ad83-241eeb8434f0",
    "viewModelInstanceId": "8969c5da-58fb-430b-8ab7-efc66c55f2a8",
    "cn": [
        {
            "type": "Ext.toolbar.Toolbar",
            "reference": {
                "name": "dockedItems",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|uiInterfaceName": "footer",
                "dock": "top",
                "ui": "footer"
            },
            "configAlternates": {
                "designer|uiInterfaceName": "string",
                "dock": "string",
                "ui": "string"
            },
            "name": "MyToolbar",
            "designerId": "37f22367-63ec-4f55-af20-f0f699fbdf6e",
            "cn": [
                {
                    "type": "Ext.button.Button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "designer|uiInterfaceName": "default-small",
                        "glyph": "f021@FontAwesome",
                        "itemId": "btnRefrescar",
                        "layout|flex": null,
                        "text": "Refrescar",
                        "ui": "default-small"
                    },
                    "configAlternates": {
                        "glyph": "auto",
                        "layout|flex": "number",
                        "text": "string",
                        "itemId": "string",
                        "designer|uiInterfaceName": "string",
                        "ui": "string"
                    },
                    "name": "MyButton1",
                    "designerId": "09753694-e33e-43a4-8ffe-8fc0cdfa4f56",
                    "cn": [
                        {
                            "type": "viewcontrollereventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onBtnRefrescarClick",
                                "implHandler": [
                                    "var me = this,",
                                    "    permisosLocalStore = me.getStore(\"PermisosLocalStore\"),",
                                    "    usuariosLocalStore = me.getStore(\"UsuariosLocalStore\"),",
                                    "    pivotePermisosLocalStore = me.getStore(\"PivotePermisosLocalStore\"),",
                                    "    tiposSesionLocalStore = me.getStore(\"TiposSesionLocalStore\"),",
                                    "    permisosList = me.view.down(\"#permisosList\"),",
                                    "    permisosListStore = permisosList.getStore(),",
                                    "    promesaPermisosLoad = new Ext.Deferred(),",
                                    "    promesaUsuariosLoad = new Ext.Deferred(),",
                                    "    promesaTiposSesionLoad = new Ext.Deferred();",
                                    "",
                                    "if (permisosListStore && permisosListStore.isDirty()) {",
                                    "    Ext.Msg.show({",
                                    "        title: \"Mensaje del sistema\",",
                                    "        message: \"Se perderan los cambios que ha realizado, Â¿Desea continuar?\",",
                                    "        buttons: Ext.Msg.YESNO,",
                                    "        icon: Ext.Msg.WARNING,",
                                    "        fn: function(result) {",
                                    "            if (result == \"yes\") {",
                                    "                refrescar();",
                                    "            }",
                                    "        }",
                                    "    });",
                                    "} else {",
                                    "    refrescar();",
                                    "}",
                                    "",
                                    "function refrescar() {",
                                    "    me.view.mask(\"Cargando...\");",
                                    "    ",
                                    "    // revierte los cambios",
                                    "    permisosList.setStore(null);",
                                    "",
                                    "    // carga los stores necesarios antes de habilitar el panel",
                                    "    permisosLocalStore.load(function(records, operation, success) {",
                                    "        if (success) {",
                                    "            promesaPermisosLoad.resolve();",
                                    "        } else {",
                                    "            promesaPermisosLoad.reject();",
                                    "        }",
                                    "    });",
                                    "    usuariosLocalStore.load(function(records, operation, success) {",
                                    "        if (success) {",
                                    "            promesaUsuariosLoad.resolve();",
                                    "        } else {",
                                    "            promesaUsuariosLoad.reject();",
                                    "        }",
                                    "    });",
                                    "    tiposSesionLocalStore.load(function(records, operation, success) {",
                                    "        if (success) {",
                                    "            promesaTiposSesionLoad.resolve();",
                                    "        } else {",
                                    "            promesaTiposSesionLoad.reject();",
                                    "        }",
                                    "    });",
                                    "",
                                    "    // al terminar de cargar los stores habilita el panel",
                                    "    Ext.Deferred.all([",
                                    "        promesaPermisosLoad,",
                                    "        promesaUsuariosLoad,",
                                    "        promesaTiposSesionLoad",
                                    "    ]).then(onStoresLoad, onStoresLoad);",
                                    "",
                                    "    function onStoresLoad() {",
                                    "        me.view.unmask();",
                                    "    }",
                                    "}"
                                ],
                                "name": "click",
                                "scope": "me"
                            },
                            "configAlternates": {
                                "fn": "string",
                                "implHandler": "code",
                                "name": "string",
                                "scope": "string"
                            },
                            "name": "onBtnRefrescarClick",
                            "designerId": "a9f56416-3ab2-4f52-8b41-cde6ba80a097"
                        }
                    ]
                }
            ]
        },
        {
            "type": "Ext.tab.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|uiInterfaceName": "default-framed",
                "frame": true,
                "itemId": "gridsTabPanel",
                "width": 600
            },
            "configAlternates": {
                "designer|uiInterfaceName": "string",
                "frame": "boolean",
                "layout|flex": "number",
                "itemId": "string",
                "width": "auto"
            },
            "name": "MyTabPanel2",
            "designerId": "881bd256-fb1a-48ab-9022-8c39e8943a70",
            "cn": [
                {
                    "type": "Ext.grid.Panel",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "columnLines": true,
                        "designer|uiInterfaceName": "default",
                        "enableColumnHide": false,
                        "enableColumnMove": false,
                        "itemId": "tiposSesionGrid",
                        "scrollable": true,
                        "showMenuHint": true,
                        "showMenuTriggers": true,
                        "store": [
                            "{TiposSesionLocalStore}"
                        ],
                        "title": "Permisos por tipo",
                        "width": 500
                    },
                    "configAlternates": {
                        "columnLines": "boolean",
                        "enableColumnHide": "boolean",
                        "enableColumnMove": "boolean",
                        "itemId": "string",
                        "scrollable": "auto",
                        "store": "binding",
                        "autoLoad": "boolean",
                        "layout|flex": "number",
                        "showMenuTriggers": "boolean",
                        "showMenuHint": "boolean",
                        "designer|uiInterfaceName": "string",
                        "frame": "boolean",
                        "width": "auto",
                        "title": "string"
                    },
                    "name": "MyGridPanel",
                    "designerId": "3d59a766-a6ac-4388-b11e-f03a9654348e",
                    "customConfigs": [
                        {
                            "group": "(Custom Properties)",
                            "name": "showMenuTriggers",
                            "type": "string"
                        },
                        {
                            "group": "(Custom Properties)",
                            "name": "showMenuHint",
                            "type": "string"
                        }
                    ],
                    "cn": [
                        {
                            "type": "Ext.grid.column.Number",
                            "reference": {
                                "name": "columns",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "dataIndex": "id",
                                "format": "0,000",
                                "text": "Id",
                                "width": 60
                            },
                            "configAlternates": {
                                "dataIndex": "datafield",
                                "text": "string",
                                "width": "auto",
                                "format": "string"
                            },
                            "name": "MyNumberColumn2",
                            "designerId": "959ca3f6-0f0a-4fb3-a8a8-3af646abc153"
                        },
                        {
                            "type": "Ext.grid.column.Column",
                            "reference": {
                                "name": "columns",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "dataIndex": "tipo_sesion",
                                "text": "Tipo",
                                "width": 200
                            },
                            "configAlternates": {
                                "dataIndex": "datafield",
                                "text": "string",
                                "flex": "number",
                                "width": "auto"
                            },
                            "name": "MyColumn2",
                            "designerId": "24d8b38c-8e76-4a30-a717-9a1748d5ab39",
                            "cn": [
                                {
                                    "type": "Ext.grid.filters.filter.String",
                                    "reference": {
                                        "name": "filter",
                                        "type": "object"
                                    },
                                    "codeClass": null,
                                    "name": "MyStringFilter7",
                                    "designerId": "6a69fb0b-cfde-4a63-aee4-9ddd7e0e3ce9"
                                }
                            ]
                        },
                        {
                            "type": "Ext.view.Table",
                            "reference": {
                                "name": "viewConfig",
                                "type": "object"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "emptyText": "No se encontraron resultados"
                            },
                            "configAlternates": {
                                "emptyText": "string"
                            },
                            "name": "MyTable",
                            "designerId": "e0c6571d-f0d5-4828-911f-4e2c19aba3d8"
                        },
                        {
                            "type": "Ext.grid.filters.Filters",
                            "reference": {
                                "name": "plugins",
                                "type": "array"
                            },
                            "codeClass": null,
                            "name": "MyGridFiltersPlugin3",
                            "designerId": "93f12ae8-60f7-406d-abbc-7f854723f555"
                        },
                        {
                            "type": "viewcontrollereventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onTiposSesionGridSelect",
                                "implHandler": [
                                    "var me = this,",
                                    "    permisosLocalStore = me.getStore(\"PermisosLocalStore\"),",
                                    "    pivotePermisosLocalStore = me.getStore(\"PivotePermisosLocalStore\"),",
                                    "    permisosList = me.view.down(\"#permisosList\"),",
                                    "    permisosListStore;",
                                    "",
                                    "permisosList.mask(\"Cargando...\");",
                                    "",
                                    "// obtiene todos los permisos",
                                    "pivotePermisosLocalStore.getProxy().setExtraParams({",
                                    "    pertenece_id:  record.get(\"id\"),",
                                    "    tipo: \"TIPO_USUARIOS\"",
                                    "});",
                                    "pivotePermisosLocalStore.load(onPivoteLoaded);",
                                    "",
                                    "function onPivoteLoaded(records, operation, success) {",
                                    "    if (success) {",
                                    "        me.armarPermisosTreeList(record.get(\"id\"), \"TIPO_USUARIOS\");",
                                    "        permisosListStore = permisosList.getStore();",
                                    "        // marca los permisos otorgados",
                                    "        Ext.Array.each(records, function(item) {",
                                    "            var treeRecord = permisosListStore.findRecord(",
                                    "                \"id\",",
                                    "                item.get(\"permiso_id\"),",
                                    "                null,",
                                    "                null,",
                                    "                null,",
                                    "                true",
                                    "            );",
                                    "",
                                    "            treeRecord.set(\"es_permitido\", true);",
                                    "            treeRecord.set(\"checked\", true);",
                                    "        });",
                                    "        permisosListStore.commitChanges();",
                                    "        permisosList.unmask();",
                                    "    }",
                                    "}"
                                ],
                                "name": "select",
                                "scope": "me"
                            },
                            "configAlternates": {
                                "fn": "string",
                                "implHandler": "code",
                                "name": "string",
                                "scope": "string"
                            },
                            "name": "onTiposSesionGridSelect",
                            "designerId": "049280be-f428-4f82-9a02-760cd84c0fee"
                        },
                        {
                            "type": "Ext.tab.Tab",
                            "reference": {
                                "name": "tabConfig",
                                "type": "object"
                            },
                            "codeClass": null,
                            "name": "TabConfig",
                            "designerId": "3c2bd3c1-5660-4ac7-aa4f-9f800bdf14d5"
                        },
                        {
                            "type": "viewcontrollereventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onTiposSesionGridBeforeSelect",
                                "implHandler": [
                                    "var me = this,",
                                    "    permisosList = me.view.down(\"#permisosList\"),",
                                    "    permisosListStore = permisosList.getStore();",
                                    "",
                                    "if (permisosListStore.isDirty()) {",
                                    "    Ext.Msg.show({",
                                    "        title: \"Mensaje del sistema\",",
                                    "        message: \"Se perderan los cambios que ha realizado, Â¿Desea continuar?\",",
                                    "        buttons: Ext.Msg.YESNO,",
                                    "        icon: Ext.Msg.WARNING,",
                                    "        fn: function(result) {",
                                    "            if (result == \"yes\") {",
                                    "                permisosListStore.rejectChanges();",
                                    "                rowmodel.select(record);",
                                    "            }",
                                    "        }",
                                    "    });",
                                    "    return false;",
                                    "}"
                                ],
                                "name": "beforeselect",
                                "scope": "me"
                            },
                            "configAlternates": {
                                "fn": "string",
                                "implHandler": "code",
                                "name": "string",
                                "scope": "string"
                            },
                            "name": "onTiposSesionGridBeforeSelect",
                            "designerId": "470dad76-7ce2-4bf8-9be2-5fb59588c0c5"
                        }
                    ]
                },
                {
                    "type": "Ext.grid.Panel",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "columnLines": true,
                        "designer|uiInterfaceName": "default",
                        "enableColumnHide": false,
                        "enableColumnMove": false,
                        "itemId": "usuariosGrid",
                        "scrollable": true,
                        "showMenuHint": true,
                        "showMenuTriggers": true,
                        "store": [
                            "{UsuariosLocalStore}"
                        ],
                        "title": "Permisos personalizados",
                        "width": 500
                    },
                    "configAlternates": {
                        "columnLines": "boolean",
                        "enableColumnHide": "boolean",
                        "enableColumnMove": "boolean",
                        "itemId": "string",
                        "scrollable": "auto",
                        "store": "binding",
                        "autoLoad": "boolean",
                        "layout|flex": "number",
                        "showMenuTriggers": "boolean",
                        "showMenuHint": "boolean",
                        "designer|uiInterfaceName": "string",
                        "frame": "boolean",
                        "width": "auto",
                        "title": "string"
                    },
                    "name": "MyGridPanel2",
                    "designerId": "877f0849-ca53-4b76-a737-4b55acb8062f",
                    "customConfigs": [
                        {
                            "group": "(Custom Properties)",
                            "name": "showMenuTriggers",
                            "type": "string"
                        },
                        {
                            "group": "(Custom Properties)",
                            "name": "showMenuHint",
                            "type": "string"
                        }
                    ],
                    "cn": [
                        {
                            "type": "Ext.grid.column.Number",
                            "reference": {
                                "name": "columns",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "dataIndex": "id",
                                "format": "0,000",
                                "text": "Id",
                                "width": 60
                            },
                            "configAlternates": {
                                "dataIndex": "datafield",
                                "text": "string",
                                "width": "auto",
                                "format": "string"
                            },
                            "name": "MyNumberColumn2",
                            "designerId": "e049364e-9445-4001-9858-63c723c53c75"
                        },
                        {
                            "type": "Ext.grid.column.Column",
                            "reference": {
                                "name": "columns",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "dataIndex": "nombre",
                                "text": "Nombre",
                                "width": 200
                            },
                            "configAlternates": {
                                "dataIndex": "datafield",
                                "text": "string",
                                "flex": "number",
                                "width": "auto"
                            },
                            "name": "MyColumn2",
                            "designerId": "fecda132-95fa-41b8-ac63-3743cfbcfe05",
                            "cn": [
                                {
                                    "type": "Ext.grid.filters.filter.String",
                                    "reference": {
                                        "name": "filter",
                                        "type": "object"
                                    },
                                    "codeClass": null,
                                    "name": "MyStringFilter7",
                                    "designerId": "07b8076b-9203-4cd9-b890-624f5ad7a227"
                                }
                            ]
                        },
                        {
                            "type": "Ext.grid.column.Column",
                            "reference": {
                                "name": "columns",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "dataIndex": "usuario",
                                "text": "Usuario",
                                "width": 120
                            },
                            "configAlternates": {
                                "dataIndex": "datafield",
                                "text": "string",
                                "width": "auto"
                            },
                            "name": "MyColumn3",
                            "designerId": "463223a3-c0b0-4f13-ab89-1ab3665bf462"
                        },
                        {
                            "type": "Ext.grid.column.Column",
                            "reference": {
                                "name": "columns",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "dataIndex": "tipo_sesion",
                                "text": "Tipo",
                                "width": 150
                            },
                            "configAlternates": {
                                "dataIndex": "datafield",
                                "text": "string",
                                "width": "auto"
                            },
                            "name": "MyColumn1",
                            "designerId": "14c874f4-f78c-4249-bfc4-23eb34f99d39",
                            "cn": [
                                {
                                    "type": "Ext.grid.filters.filter.List",
                                    "reference": {
                                        "name": "filter",
                                        "type": "object"
                                    },
                                    "codeClass": null,
                                    "name": "MyListFilter",
                                    "designerId": "cca72aab-5dcb-46c5-b3c9-3a3dd8276e81"
                                }
                            ]
                        },
                        {
                            "type": "Ext.view.Table",
                            "reference": {
                                "name": "viewConfig",
                                "type": "object"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "emptyText": "No se encontraron resultados"
                            },
                            "configAlternates": {
                                "emptyText": "string"
                            },
                            "name": "MyTable",
                            "designerId": "9cb51aa2-537d-4a2a-ae5d-21efe2225a52"
                        },
                        {
                            "type": "Ext.grid.filters.Filters",
                            "reference": {
                                "name": "plugins",
                                "type": "array"
                            },
                            "codeClass": null,
                            "name": "MyGridFiltersPlugin3",
                            "designerId": "5e84a149-1da9-4995-96d7-4863069c34c2"
                        },
                        {
                            "type": "viewcontrollereventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onUsuariosGridSelect",
                                "implHandler": [
                                    "var me = this,",
                                    "    permisosLocalStore = me.getStore(\"PermisosLocalStore\"),",
                                    "    pivotePermisosLocalStore = me.getStore(\"PivotePermisosLocalStore\"),",
                                    "    permisosList = me.view.down(\"#permisosList\"),",
                                    "    permisosListStore;",
                                    "",
                                    "permisosList.mask(\"Cargando...\");",
                                    "",
                                    "// obtiene todos los permisos",
                                    "pivotePermisosLocalStore.getProxy().setExtraParams({",
                                    "    pertenece_id:  record.get(\"id\"),",
                                    "    tipo: \"USUARIOS\"",
                                    "});",
                                    "pivotePermisosLocalStore.load(onPivoteUsuariosLoaded);",
                                    "",
                                    "function onPivoteUsuariosLoaded(records, operation, success) {",
                                    "    if (success) {",
                                    "        if (records.length > 0) {",
                                    "            me.armarPermisosTreeList(record.get(\"id\"), \"USUARIOS\");",
                                    "            permisosListStore = permisosList.getStore();",
                                    "            // marca los permisos otorgados",
                                    "            Ext.Array.each(records, function(item) {",
                                    "                var treeRecord = permisosListStore.findRecord(",
                                    "                    \"permiso_id\",",
                                    "                    item.get(\"permiso_id\"),",
                                    "                    null,",
                                    "                    null,",
                                    "                    null,",
                                    "                    true",
                                    "                );",
                                    "",
                                    "                treeRecord.set(\"es_permitido\", true);",
                                    "                treeRecord.set(\"checked\", true);",
                                    "            });",
                                    "            permisosListStore.commitChanges();",
                                    "            permisosList.unmask();",
                                    "        } else {",
                                    "            // en caso que el usuario no tenga permisos personalizados se tomaran los del tipo de usuario",
                                    "            pivotePermisosLocalStore.getProxy().setExtraParams({",
                                    "                pertenece_id:  record.get(\"tipo_sesion_id\"),",
                                    "                tipo: \"TIPO_USUARIOS\"",
                                    "            });",
                                    "            pivotePermisosLocalStore.load(onPivoteTipoUsuariosLoaded);",
                                    "        }",
                                    "    }",
                                    "}",
                                    "",
                                    "function onPivoteTipoUsuariosLoaded(records, operation, success) {",
                                    "    if (success) {",
                                    "        me.armarPermisosTreeList(record.get(\"id\"), \"USUARIOS\");",
                                    "        permisosListStore = permisosList.getStore();",
                                    "        // marca los permisos otorgados",
                                    "        Ext.Array.each(records, function(item) {",
                                    "            var treeRecord = permisosListStore.findRecord(",
                                    "                \"permiso_id\",",
                                    "                item.get(\"permiso_id\"),",
                                    "                null,",
                                    "                null,",
                                    "                null,",
                                    "                true",
                                    "            );",
                                    "",
                                    "            treeRecord.set(\"es_permitido\", true);",
                                    "            treeRecord.set(\"checked\", true);",
                                    "        });",
                                    "",
                                    "        // agrega los records al pivote como nuevos",
                                    "        copiaRecords = records.map(function(item) {",
                                    "            var copia = {};",
                                    "",
                                    "            copia.pertenece_id = record.get(\"id\");",
                                    "            copia.permiso_id = item.get(\"permiso_id\");",
                                    "            copia.tipo = \"USUARIOS\";",
                                    "",
                                    "            return copia;",
                                    "        });",
                                    "        pivotePermisosLocalStore.removeAll();",
                                    "        pivotePermisosLocalStore.commitChanges();",
                                    "        pivotePermisosLocalStore.add(copiaRecords);",
                                    "        permisosList.unmask();",
                                    "    }",
                                    "}"
                                ],
                                "name": "select",
                                "scope": "me"
                            },
                            "configAlternates": {
                                "fn": "string",
                                "implHandler": "code",
                                "name": "string",
                                "scope": "string"
                            },
                            "name": "onUsuariosGridSelect",
                            "designerId": "5c7c9224-6031-4928-b663-a4d29a5f0e55"
                        },
                        {
                            "type": "Ext.tab.Tab",
                            "reference": {
                                "name": "tabConfig",
                                "type": "object"
                            },
                            "codeClass": null,
                            "name": "TabConfig",
                            "designerId": "81f6b337-bb36-4be3-8e29-84879af1a0eb"
                        },
                        {
                            "type": "viewcontrollereventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onUsuariosGridBeforeSelect",
                                "implHandler": [
                                    "var me = this,",
                                    "    permisosList = me.view.down(\"#permisosList\"),",
                                    "    permisosListStore = permisosList.getStore();",
                                    "",
                                    "if (permisosListStore.isDirty()) {",
                                    "    Ext.Msg.show({",
                                    "        title: \"Mensaje del sistema\",",
                                    "        message: \"Se perderan los cambios que ha realizado, Â¿Desea continuar?\",",
                                    "        buttons: Ext.Msg.YESNO,",
                                    "        icon: Ext.Msg.WARNING,",
                                    "        fn: function(result) {",
                                    "            if (result == \"yes\") {",
                                    "                permisosListStore.rejectChanges();",
                                    "                rowmodel.select(record);",
                                    "            }",
                                    "        }",
                                    "    });",
                                    "    return false;",
                                    "}"
                                ],
                                "name": "beforeselect",
                                "scope": "me"
                            },
                            "configAlternates": {
                                "fn": "string",
                                "implHandler": "code",
                                "name": "string",
                                "scope": "string"
                            },
                            "name": "onUsuariosGridBeforeSelect",
                            "designerId": "77a4b5ce-9bfa-4877-835a-f313c4007654"
                        }
                    ]
                }
            ]
        },
        {
            "type": "Ext.tab.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "activeTab": 0,
                "designer|uiInterfaceName": "default-framed",
                "frame": true,
                "layout|flex": 1
            },
            "configAlternates": {
                "activeTab": "auto",
                "designer|uiInterfaceName": "string",
                "frame": "boolean",
                "layout|flex": "number"
            },
            "name": "MyTabPanel",
            "designerId": "195d3153-5370-4870-b2f5-05d171cb716b",
            "cn": [
                {
                    "type": "Ext.tree.Panel",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "displayField": "permiso",
                        "itemId": "permisosList",
                        "lines": false,
                        "rootVisible": false,
                        "title": "Permisos",
                        "useArrows": true
                    },
                    "configAlternates": {
                        "displayField": "datafield",
                        "itemId": "string",
                        "lines": "boolean",
                        "rootVisible": "boolean",
                        "title": "string",
                        "useArrows": "boolean"
                    },
                    "name": "MyTreePanel",
                    "designerId": "c3bfc7c5-188a-44fa-883a-89fbd16dc02a",
                    "cn": [
                        {
                            "type": "Ext.toolbar.Toolbar",
                            "reference": {
                                "name": "dockedItems",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "designer|uiInterfaceName": "footer",
                                "dock": "top",
                                "ui": "footer"
                            },
                            "configAlternates": {
                                "designer|uiInterfaceName": "string",
                                "dock": "string",
                                "ui": "string"
                            },
                            "name": "MyToolbar3",
                            "designerId": "b25cf603-9c5d-4746-a98a-f9cd0910b501",
                            "cn": [
                                {
                                    "type": "Ext.button.Button",
                                    "reference": {
                                        "name": "items",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "glyph": "f0c7@FontAwesome",
                                        "itemId": "btnGuardar",
                                        "layout|flex": null,
                                        "text": "Guardar",
                                        "tooltip": "Guardar cambios"
                                    },
                                    "configAlternates": {
                                        "permissionId": "number",
                                        "glyph": "auto",
                                        "itemId": "string",
                                        "layout|flex": "number",
                                        "text": "string",
                                        "tooltip": "string"
                                    },
                                    "name": "MyButton2",
                                    "designerId": "a0818c47-4050-4ed7-b530-0f6e32be1c6b",
                                    "cn": [
                                        {
                                            "type": "viewcontrollereventbinding",
                                            "reference": {
                                                "name": "listeners",
                                                "type": "array"
                                            },
                                            "codeClass": null,
                                            "userConfig": {
                                                "fn": "onBtnGuardarClick",
                                                "implHandler": [
                                                    "var me = this,",
                                                    "    pivotePermisosLocalStore = me.getStore(\"PivotePermisosLocalStore\"),",
                                                    "    permisosList = me.view.down(\"#permisosList\"),",
                                                    "    permisosListStore = permisosList.getStore(),",
                                                    "    waitWindow, esPersonalizado, index;",
                                                    "",
                                                    "if (!permisosListStore.isDirty()) {",
                                                    "    return;",
                                                    "}",
                                                    "",
                                                    "waitWindow = Ext.Msg.wait(\"Guardando cambios...\");",
                                                    "",
                                                    "permisosListStore.each(function(item) {",
                                                    "    var pivoteRecord = pivotePermisosLocalStore.findRecord(",
                                                    "        \"permiso_id\",",
                                                    "        item.get(\"permiso_id\"),",
                                                    "        null,",
                                                    "        null,",
                                                    "        null,",
                                                    "        true",
                                                    "    );",
                                                    "",
                                                    "    if (item.get(\"es_permitido\") && !pivoteRecord) {",
                                                    "        pivotePermisosLocalStore.add({",
                                                    "            pertenece_id: item.get(\"pertenece_id\"),",
                                                    "            permiso_id: item.get(\"permiso_id\"),",
                                                    "            tipo: item.get(\"tipo\")",
                                                    "        });",
                                                    "    } else if (!item.get(\"es_permitido\") && pivoteRecord) {",
                                                    "        pivotePermisosLocalStore.remove(pivoteRecord);",
                                                    "    }",
                                                    "});",
                                                    "",
                                                    "pivotePermisosLocalStore.sync({",
                                                    "    success: onSyncSuccess",
                                                    "});",
                                                    "",
                                                    "function onSyncSuccess() {",
                                                    "    pivotePermisosLocalStore.commitChanges();",
                                                    "    permisosListStore.commitChanges();",
                                                    "    waitWindow.close();",
                                                    "}"
                                                ],
                                                "name": "click",
                                                "scope": "me"
                                            },
                                            "configAlternates": {
                                                "fn": "string",
                                                "implHandler": "code",
                                                "name": "string",
                                                "scope": "string"
                                            },
                                            "name": "onBtnGuardarClick",
                                            "designerId": "53d6b38f-9b69-4481-9eb5-8e3f8801d4b9"
                                        }
                                    ]
                                },
                                {
                                    "type": "Ext.button.Button",
                                    "reference": {
                                        "name": "items",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "glyph": "f0e2@FontAwesome",
                                        "itemId": "btnRevertir",
                                        "layout|flex": null,
                                        "text": "Revertir",
                                        "tooltip": "Revertir cambios"
                                    },
                                    "configAlternates": {
                                        "layout|flex": "number",
                                        "text": "string",
                                        "permissionId": "number",
                                        "glyph": "auto",
                                        "itemId": "string",
                                        "tooltip": "string"
                                    },
                                    "name": "MyButton",
                                    "designerId": "93444fe9-4a9d-433b-b7d7-06cdc6f44b85",
                                    "cn": [
                                        {
                                            "type": "viewcontrollereventbinding",
                                            "reference": {
                                                "name": "listeners",
                                                "type": "array"
                                            },
                                            "codeClass": null,
                                            "userConfig": {
                                                "fn": "onBtnRevertirClick",
                                                "implHandler": [
                                                    "var me = this,",
                                                    "    permisosList = me.view.down(\"#permisosList\"),",
                                                    "    permisosListStore = permisosList.getStore();",
                                                    "",
                                                    "if (permisosListStore && permisosListStore.isDirty()) {",
                                                    "    Ext.Msg.show({",
                                                    "        title: \"Mensaje del sistema\",",
                                                    "        message: \"Se perderan los cambios que ha realizado, Â¿Desea continuar?\",",
                                                    "        buttons: Ext.Msg.YESNO,",
                                                    "        icon: Ext.Msg.WARNING,",
                                                    "        fn: function(result) {",
                                                    "            if (result == \"yes\") {",
                                                    "                // revierte los cambios",
                                                    "                permisosListStore.rejectChanges();",
                                                    "                permisosListStore.each(function(item) {",
                                                    "                    item.set(\"checked\", item.get(\"es_permitido\"));",
                                                    "                });",
                                                    "            }",
                                                    "        }",
                                                    "    });",
                                                    "}"
                                                ],
                                                "name": "click",
                                                "scope": "me"
                                            },
                                            "configAlternates": {
                                                "fn": "string",
                                                "implHandler": "code",
                                                "name": "string",
                                                "scope": "string"
                                            },
                                            "name": "onBtnRevertirClick",
                                            "designerId": "1cf11ace-d542-4807-a826-36d01257fb67"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "type": "Ext.tab.Tab",
                            "reference": {
                                "name": "tabConfig",
                                "type": "object"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "closable": false
                            },
                            "configAlternates": {
                                "closable": "boolean"
                            },
                            "name": "TabConfig4",
                            "designerId": "ca407939-844e-4ecb-ac14-8d5b710a3dbf"
                        },
                        {
                            "type": "Ext.tree.View",
                            "reference": {
                                "name": "viewConfig",
                                "type": "object"
                            },
                            "codeClass": null,
                            "name": "MyTreeView",
                            "designerId": "595d3555-829b-4d3e-842f-f1c9bccb745e"
                        },
                        {
                            "type": "viewcontrollereventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onPermisosListCheckChange",
                                "implHandler": [
                                    "var me = this,",
                                    "    parentNode = node.parentNode,",
                                    "    childNodes = node.childNodes;",
                                    "    permisosList = me.view.down(\"#permisosList\");",
                                    "",
                                    "node.set(\"es_permitido\", checked);",
                                    "if (checked && parentNode && !parentNode.get(\"checked\")) {",
                                    "    parentNode.set(\"checked\", true);",
                                    "    parentNode.set(\"es_permitido\", true);",
                                    "    permisosList.fireEvent(\"checkchange\", parentNode, true);",
                                    "} else if (!checked && childNodes) {",
                                    "    Ext.Array.each(childNodes, function(item) {",
                                    "        if (item.get(\"checked\")) {",
                                    "            item.set(\"checked\", false);",
                                    "            item.set(\"es_permitido\", false);",
                                    "            permisosList.fireEvent(\"checkchange\", item, false);",
                                    "        }",
                                    "    });",
                                    "}"
                                ],
                                "name": "checkchange",
                                "scope": "me"
                            },
                            "configAlternates": {
                                "fn": "string",
                                "implHandler": "code",
                                "name": "string",
                                "scope": "string"
                            },
                            "name": "onPermisosListCheckChange",
                            "designerId": "bf1694c1-49f7-4b97-9b21-e37e00655720"
                        }
                    ]
                }
            ]
        },
        {
            "type": "viewcontrollereventbinding",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onPermisosPanelAfterRender",
                "implHandler": [
                    "var me = this,",
                    "    permisosLocalStore = me.getStore(\"PermisosLocalStore\"),",
                    "    usuariosLocalStore = me.getStore(\"UsuariosLocalStore\"),",
                    "    pivotePermisosLocalStore = me.getStore(\"PivotePermisosLocalStore\"),",
                    "    tiposSesionLocalStore = me.getStore(\"TiposSesionLocalStore\"),",
                    "    promesaPermisosLoad = new Ext.Deferred(),",
                    "    promesaUsuariosLoad = new Ext.Deferred(),",
                    "    promesaTiposSesionLoad = new Ext.Deferred();",
                    "",
                    "me.view.mask(\"Cargando...\");",
                    "",
                    "// carga los stores necesarios antes de habilitar el panel",
                    "permisosLocalStore.load(function(records, operation, success) {",
                    "    if (success) {",
                    "        promesaPermisosLoad.resolve();",
                    "    } else {",
                    "        promesaPermisosLoad.reject();",
                    "    }",
                    "});",
                    "usuariosLocalStore.load(function(records, operation, success) {",
                    "    if (success) {",
                    "        promesaUsuariosLoad.resolve();",
                    "    } else {",
                    "        promesaUsuariosLoad.reject();",
                    "    }",
                    "});",
                    "tiposSesionLocalStore.load(function(records, operation, success) {",
                    "    if (success) {",
                    "        promesaTiposSesionLoad.resolve();",
                    "    } else {",
                    "        promesaTiposSesionLoad.reject();",
                    "    }",
                    "});",
                    "",
                    "// al terminar de cargar los stores habilita el panel",
                    "Ext.Deferred.all([",
                    "    promesaPermisosLoad,",
                    "    promesaUsuariosLoad,",
                    "    promesaTiposSesionLoad",
                    "]).then(onStoresLoad, onStoresLoad);",
                    "",
                    "function onStoresLoad() {",
                    "    me.view.unmask();",
                    "}"
                ],
                "name": "afterrender",
                "scope": "me"
            },
            "configAlternates": {
                "fn": "string",
                "implHandler": "code",
                "name": "string",
                "scope": "string"
            },
            "name": "onPermisosPanelAfterRender",
            "designerId": "39ea1448-cb1b-428e-b35a-043c85c41ad4"
        }
    ]
}