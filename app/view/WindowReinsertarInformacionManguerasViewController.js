/*
 * File: app/view/WindowReinsertarInformacionManguerasViewController.js
 *
 * This file was generated by Sencha Architect
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Entregas100Web.view.WindowReinsertarInformacionManguerasViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.windowreinsertarinformacionmangueras',

    onBtnAgregarInformacionClick: function(button, e, eOpts) {
        var win =  button.up('window');

        var data = [];
        var store = Ext.getStore('mangueras.ManguerasReInsertarStore');
        Ext.each(store.data.items, function(values){
            data.push(values.data);
        });

        Ext.Msg.wait('<center>Cargando Información, Espere un momento</center>','<center>Mensaje de Sistema</center>');
        Ext.Ajax.request({
            url: 'api/Mangueras/insertManguerasReInsertar',
            params:{
                records : Ext.JSON.encode(data)
            },
            headers:{
                Accept: 'application/json, */*'
            },
            success:function(response){
                try{
                    var resp = JSON.parse(response.responseText);
                    Ext.Msg.hide();
                    if(resp.success){
                        Ext.MessageBox.show({
                            title: '<center>Mensaje de Sistema</center>',
                            msg: resp.message,
                            icon: Ext.MessageBox.INFO,
                            buttons: Ext.Msg.OK,
                            buttonText:{ok:"Aceptar"},
                            closable:false
                        });
                        win.close();
                        Ext.getStore('mangueras.ManguerasReInsertarStore').load();

                    }else{
                        Ext.MessageBox.show({
                            title: '<center>Mensaje de Sistema</center>',
                            msg: resp.message,
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.Msg.OK,
                            buttonText:{ok:"Aceptar"},
                            closable:false
                        });
                    }
                }catch(Exception){
                    Ext.Msg.hide(
                    null,
                    function(){
                        Ext.MessageBox.show({
                            title: '<center>Mensaje de Sistema</center>',
                            msg: Exception,
                            closable:false,
                            buttons: Ext.Msg.OK,
                            buttonText:{ok:"Aceptar"},
                            icon: Ext.Msg.ERROR
                        });
                    }
                    );
                }
            },
            failure:function(response){
                Ext.MessageBox.show({
                    title: '<center>Mensaje de Sistema</center>',
                    msg: '<center>Fallo la conexión al servidor!</center>',
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.Msg.OK,
                    buttonText:{ok:"Aceptar"},
                    closable:false
                });
            }
        });
    }

});
